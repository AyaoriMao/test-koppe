# ビューの作成

# ビューの作成
このページのビューでは冒頭でも記載したように、ListViewという汎用クラスビューを利用することとします。

```
amazon/
　├ static/
　├ __init__.py
　├ apps.py
　├ models.py
　├ views.py　←　このファイルを修正します。
　├ admin.py
　├ migrations/
　└ test.py
```
views.pyの最後に以下のコードを追記しましょう。

```
～ 略 ～
from .models import *
～ 略 ～
class ItemList(generic.ListView):
    model = Product
    template_name = 'amazon/item_list.html'
    def get_queryset(self):
        products = Product.objects.all()
        if 'q' in self.request.GET and self.request.GET['q'] != None:
            q = self.request.GET['q']
            products = products.filter(name__icontains = q)

        return products

```

ここでは、ItemListクラスというdjangoのListViewのサブクラスを定義しており、前回同様、テンプレートをtemplate_nameにて指定しております。またmodelプロパティにはリスト表示したいモデルを指定しますので、今回はProductクラスを指定します。
get_queryset関数が定義されておりますが、この関数がテンプレートに渡すモデルオブジェクトのリストを返す部分になります。この関数はListViewクラスですでに定義されており、サブクラスでオーバライドされなければデフォルトで全件取得するよう実装されております。今回は、サーチバーでの入力値を元に商品名を検索した結果のみを返す仕様にしたいので、この関数をオーバライドします。この関数はテンプレートに渡すクエリセット型の値を戻り値として返す必要があり、ここでリターンされた値はテンプレート内で"object_list"という名前でアクセスできるようになります。

では一行ずつ解説します。
* `products = Product.objects.all()`
    * Productクラスの全オブジェクトをクエリセットとして取得します。
* `if 'q' in self.request.GET and self.request.GET['q'] != None`
    * 処理しているリクエストのGETパラメータにqというパラメータが存在し、かつNoneではないかのチェックをしています。いわば、ブラウザ側から検索値qが渡されているかどうかを確認しています。
* `products = products.filter(name__icontains = q)`
    * 先ほど全件取得したクエリセットに対し、検索値で絞り込みをかけております。今回はnameに検索値を含むという条件で絞り込みをかけております。

* `return products`
    * クエリセットを返します。

以上で今回のパートは終了です。

お疲れ様でした。



