# テンプレートの作成

## 商品詳細テンプレートの修正
今回は新たにレビュ用のテンプレートを作成するのではなく、商品一覧にレビュフォームを埋め込む形式を取ります。
作成済みのitem_detail.htmlファイルを修正しましょう。

```
techpit/
　 ├ amazon/
　 ├ static/
　 ├ manage.py
　 ├ templates/ 
 　　└ amazon/
     ・・・
        ├ item_detail.html　← 修正
　　　・・・
```

item_detail.htmlを以下のように修正します。

修正前
```
〜略〜
<hr>
<div class="row d-flex justify-content-center wow fadeIn">
〜略〜
```


修正後
```
<script src="{% static 'js/rater.js' %}" type="text/javascript"></script>

〜略〜
<hr>
{% if user.is_authenticated %}
<!-- review form -->

<form action="" method="POST">
    {{ form.non_field_errors }}
    {% for field in form %}
        <div class="form-group">
            <label for="{{ field.id_for_label }}">{{ field.label_tag }}</label>
            {% if field.name == 'rating' %}
            <div class="rating"></div>
            {% endif %}
            {{ field }}
            {{ field.errors }}
        </div>
    {% endfor %}
    {% csrf_token %}
    <button type="submit" class="btn btn-primary">投稿</button>
</form> <!-- review form -->

<hr>
{% endif %}
<!-- reviews -->
{% if object.reviews.all %}
<div class="container">
    <h2 class="text-center">レビュー</h2>

{% for review in object.reviews.all %}      
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-2">
                    <div class="icon-wrap icon-md bg2 round text-secondary text-center">
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="pull-left">
                        <small>{{ review.user.name }}</small>
                    </div>
                    
                </div>
                <div class="col-md-10">
                    <strong>{{ review.title }}</strong>
                    <p class="float-right">
                        {% if review.rating > 0 %}
                        <span>★</i></span>
                        {% else %}
                        <span>☆</span>
                        {% endif %}
                        {% if review.rating > 1 %}
                        <span>★</i></span>
                        {% else %}
                        <span>☆</span>
                        {% endif %}
                        {% if review.rating > 2 %}
                        <span>★</i></span>
                        {% else %}
                        <span>☆</span>
                        {% endif %}
                        {% if review.rating > 3 %}
                        <span>★</i></span>
                        {% else %}
                        <span>☆</span>
                        {% endif %}
                        {% if review.rating > 4 %}
                        <span>★</i></span>
                        {% else %}
                        <span>☆</span>
                        {% endif %}
    
                    </p>
                    <div class="clearfix"></div>
                    <p>{{ review.comment }}</p>
                </div>
            </div>
            
        </div>
    </div>
{% endfor %}
    
</div>
{% else %}
<p>レビュはありません</p>
{% endif %}
<hr>
<div class="row d-flex justify-content-center wow fadeIn">
〜略〜

{% block scripts %}
<script>
    $(function() {
        var options = {
            max_value: 5,
            step_size: 1,
            initial_value: 0,
            selected_symbol_type: 'utf8_star', // Must be a key from symbols
            cursor: 'default',
            readonly: false,
            change_once: false, // Determines if the rating can only be set once
            // ajax_method: 'POST',
            // url: 'http://localhost/test.php',
            // additional_data: {} // Additional data to send to the server
        }

        var $rating = $(".rating");
        var $rating_input = $('#id_rating');

        $rating.rate(options);
        $rating.on('change', function() {
            $rating_input.val(parseInt($(this).rate('getValue')));
        });
    });


</script>
{% endblock %}
```

新たにレビュフォームとその商品に紐付くレビュを表示しております。
また、レビュの星を表現するためにrater.jsというjsフレームワークを利用しているので、その読み込みも行なっております。

以上で今回のパートは終了です。

お疲れ様でした。

